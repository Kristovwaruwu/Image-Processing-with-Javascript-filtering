<!DOCTYPE HTML>
<html>

<head>
	<title>Pengolahan Citra</title>


	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />

	<!--css file-->
	<link rel="stylesheet" type="text/css" href="semantic.min.css" />

	<script src="jquery.min.js" type="text/javascript"></script>
	<!--css file-->

</head>

<body>
	<div class="container">
		<div class="ui container">
			<div class="ui segment" style="height:	100%">
				<h1 class="ui center aligned header">Pengolahan Citra</h1>
				<p class="ui center aligned sub header">Eukardi Yanto Kristov Waruwu (171401131)</p>
				<div class="ui divider"></div>
				<div class="ui segment">
					<div class="ui grid">
						<div class="five wide column">
							<div class="ui card">
								<div class="image">
									<canvas id='canvas1'></canvas>
								</div>
								<div class="content">
									<a class="header">Contoh Citra yang diolah</a>
									<div class="meta">
										<span class="date">gambar.png</span>
									</div>
									<div class="ui buttons">
										<button class="ui positive button" id="read">Read image</button>
										<div class="or" data-text=""></div>
										<button class="ui negative button" id="ori">Original image</button>
									</div>
								</div>
							</div>
						</div>
						<div class="eleven wide column">
							<div class="ui inverted segment">
								<h3 class="ui center aligned header">Kumpulan filter untuk mengolah citra</h3>
								<div class="ui secondary blue segment">
									<div class="ui pointing menu">
										
										<a href="#" class="item active">
											<h4 class="ui header">Image Filtering</h4>
										</a>
										<a href="index2.html" class="item">
											Edge Detection
										</a>
										<a href="index3.html" class="item">
											Transformation
										</a>
									</div>
									<div class="ui segment">
										<button class="ui button" id='negatif'>Negative</button>
										<button class="ui button" id='grayscl'>Grayscale</button>
										<button class="ui button" id='flip1'>Flip 1</button>
										<button class="ui button" id='flip2'>Flip 2</button>
										<button class="ui button" id='mirror'>Mirroring</button><br>
										<hr>
										<div class="ui labeled input">
												<div class="ui red basic horizontal label">Filter Image</div>
												<input type="number" id="num">
												<button class="ui positive button" id='mean'>Mean</button>
												<button class="ui positive button" id='median'>Median</button>
											</div>
											<hr>
										<div class="ui labeled input">
											<div class="ui red basic horizontal label">Check Histogram</div>
											<select class="ui selection dropdown" id='histval'>
												<option value='0'>Red</option>
												<option value='1'>Green</option>
												<option value='2'>Blue</option>
											</select>
											<button class="ui positive button" id='hist1'>Histogram</button>
										</div>
										<hr>
										<div class="ui two column grid">
											<div class="row">
												<div class="column">
													<div class="ui large labels">
														<div class="ui red basic label">Red</div>
														<input type='range' min='-255' max='255' data-id='1'
															id='ch1'><input type='text' id='chv1' size='3' disabled
															value='0'><br>
														<div class="ui green basic label">Green</div>
														<input class="ui input" type='range' min='-255' max='255'
															data-id='2' id='ch2'><input type='text' id='chv2' size='3'
															disabled value='0'><br>
														<div class="ui blue basic label">Blue</div>
														<input type='range' min='-255' max='255' data-id='3'
															id='ch3'><input type='text' id='chv3' size='3' disabled
															value='0'><br>
														<div class="ui basic label">Alpha</div>
														<input type='range' min='0' max='255' data-id='4' id='ch4'
															value='255'><input type='text' id='chv4' size='3' disabled
															value='255'><br><br>
														<button class="ui blue button" id='default'>Default
															RGBA</button>
													</div>
												</div>
												<div class="column">
													<canvas id='canvas2'></canvas>
												</div>
											</div>
										</div>

									</div>

									<hr>
									<div class="ui two column grid">
										<div class="row">
											<div class="column">
												<div class="ui black large labels">
													<div class="ui label">Threshold</div>
													<input class="ui input" type='range' min='0' max='255'
														id='threshold' value='0'><input type='text' id='threshold_val'
														size='3' disabled value='0'>
												</div>
											</div>
											<div class="column">
												<div class="ui black large labels">
													<div class="ui label">Brightness</div>
													<input type='range' min='-255' max='255' data-id="4" id='brightness'
														value='0'><input type='text' id='brightness_val' size='3'
														disabled value='0'>
												</div>
											</div>	
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

</body>
<style>
	body {
		background: rgba(255, 255, 255, 1);
	}
</style>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"
	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src='pc.js'></script>
<script src="semantic.js"></script>
<script src="iframe-content.js"></script>
<script src="iframe.js"></script>

<script>

	var canvas = document.getElementById('canvas1')
	var obj = new pc(canvas)
	obj.image2canvas("asset/gambarCopy.jpg")
	var canvas2 = document.getElementById('canvas2')
	var obj2 = new pc(canvas2)
	obj2.blank2canvas(200, 200)
	var tes = new Array()
	console.log(tes);
	document.getElementById('read').addEventListener('click', function () {
		tes = obj.image2read()
		console.log(tes);
	})
	document.getElementById('ori').addEventListener('click', function () {
		obj.image2original()
	})

	function rgbachange() {
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var j = 0; j < tesbackup.length; j++) {
			tesbackup[j][0] += parseInt(document.getElementById('ch1').value)
			tesbackup[j][1] += parseInt(document.getElementById('ch2').value)
			tesbackup[j][2] += parseInt(document.getElementById('ch3').value)
			tesbackup[j][3] = parseInt(document.getElementById('ch4').value)
		}
		for (var i = 1; i <= 4; i++) document.getElementById('chv' + i).value = document.getElementById('ch' + i).value
		obj.array2canvas(tesbackup)
	}

	for (var i = 1; i <= 4; i++) {
		document.getElementById('ch' + i).addEventListener('input', function () {
			rgbachange()
		})
	}

	document.getElementById('default').addEventListener('click', function () {
		for (var i = 1; i <= 3; i++) {
			document.getElementById('ch' + i).value = 0
		}
		document.getElementById('ch4').value = 255
		rgbachange()
	})

	document.getElementById('hist1').addEventListener('click', function () {
		var hist = obj.hist2read([parseInt(document.getElementById("histval").value)]) //Call [R,G,B,A] as [0,1,2,3], can input more than 1 but only [0..3] parameter only
		obj2.hist2canvas(hist[0], 10)
	})

	document.getElementById('negatif').addEventListener('click', function () { //efek negatif
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tesbackup.length; i++) {
			tes[i][0] = (255 - tesbackup[i][0])
			tes[i][1] = (255 - tesbackup[i][1])
			tes[i][2] = (255 - tesbackup[i][2])
			tes[i][3] = tesbackup[i][3]
		}
		obj.array2canvas(tes)
	})

	document.getElementById('grayscl').addEventListener('click', function () { //efek grayscale
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tesbackup.length; i++) {
			var total = Math.floor((tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2]) / 3)
			tes[i][0] = total
			tes[i][1] = total
			tes[i][2] = total
			tes[i][3] = tesbackup[i][3]
		}
		obj.array2canvas(tes)
	})

	document.getElementById('threshold').addEventListener('input', function () { //efek threshold
		document.getElementById('threshold_val').value = this.value
		batas = parseInt(this.value)
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tes.length; i++) {
			gabung = Math.floor((tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2]) / 3)
			if (gabung < batas) {
				gabung = 0
			}
			else {
				gabung = 255
			}
			tes[i][0] = gabung
			tes[i][1] = gabung
			tes[i][2] = gabung
			tes[i][3] = tes[i][3]
		}
		obj.array2canvas(tesbackup)
	})

	document.getElementById('brightness').addEventListener('input', function () { //efek brightness
		document.getElementById('brightness_val').value = this.value
		p = parseInt(this.value)
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tes.length; i++) {
			tesbackup[i][0] = (tes[i][0] + p)
			tesbackup[i][1] = (tes[i][1] + p)
			tesbackup[i][2] = (tes[i][2] + p)
			tesbackup[i][3] = tes[i][3]
		}
		obj.array2canvas(tesbackup)
	})


	//<!--FLIP HORIZONTAL-->
	document.getElementById('flip1').addEventListener('click', function () {
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy

		for (var i = 0; i < tesbackup.length; i++) {
			x = obj.i2x(i) //mengambil nilai index array ke dalam koordinat x
			y = obj.i2y(i)
			posnow = obj.xy2i(obj.width - 1 - x, y) //mengubah index array xy kedalam koordinat xy
			tes[i][0] = tesbackup[posnow][0]
			tes[i][1] = tesbackup[posnow][1]
			tes[i][2] = tesbackup[posnow][2]
			tes[i][3] = tesbackup[posnow][3]
		}
		obj.array2canvas(tes)
	})

	//<!-- FLIP VERTIKAL -->
	document.getElementById('flip2').addEventListener('click', function () {
		//copy array to array without reference

		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}

			tesbackup.push(temp)
		}
		//end of copy

		for (var i = 0; i < tesbackup.length; i++) {
			x = obj.i2x(i)
			y = obj.i2y(i)
			posnow = obj.xy2i(x, obj.height - 1 - y)
			tes[i][0] = tesbackup[posnow][0]
			tes[i][1] = tesbackup[posnow][1]
			tes[i][2] = tesbackup[posnow][2]
			tes[i][3] = tesbackup[posnow][3]
		}

		obj.array2canvas(tes)

	})

	//<!-- EFEK MIRRORING -->
	document.getElementById('mirror').addEventListener('click', function () {
		//copy array to array without reference
		tesbackup = new Array()

		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}

			tesbackup.push(temp)
		}

		//end of copy 

		var wnow = obj.width
		for (var i = 0; i < tesbackup.length; i++) {
			x = obj.i2x(i)
			y = obj.i2y(i)
			if (x < wnow / 2) {
				posnow = obj.xy2i(wnow - x - 1, y)
				tes[i][0] = tesbackup[posnow][0]
				tes[i][1] = tesbackup[posnow][1]
				tes[i][2] = tesbackup[posnow][2]
				tes[i][3] = tesbackup[posnow][3]
			}
		}

		obj.array2canvas(tes)
	})

	//<!--Mean Filtering-->
	document.getElementById('mean').addEventListener('click', function () {
		filtersize = parseInt(document.getElementById('num').value)
		if (filtersize % 2 == 0 || filtersize < 3) {
			warning('FilterSize must Odd Number and >= 3')
			return false
		}
		borderparam = (filtersize - 1) / 2
		meandoubleparam = filtersize * filtersize
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tes.length; i++) {
			xstart = obj.i2x(i) - borderparam
			xend = obj.i2x(i) + borderparam
			ystart = obj.i2y(i) - borderparam
			yend = obj.i2y(i) + borderparam
			red = 0
			green = 0
			blue = 0
			for (var yc = ystart; yc <= yend; yc++) {
				for (var xc = xstart; xc <= xend; xc++) {
					if (yc >= 0 && xc >= 0 && xc < obj.width && yc < obj.height) {
						red += tesbackup[obj.xy2i(xc, yc)][0]
						green += tesbackup[obj.xy2i(xc, yc)][1]
						blue += tesbackup[obj.xy2i(xc, yc)][2]
					}
				}
			}
			tes[i][0] = Math.floor(red / meandoubleparam)
			tes[i][1] = Math.floor(green / meandoubleparam)
			tes[i][2] = Math.floor(blue / meandoubleparam)
		}
		obj.array2canvas(tes)
	})

	//<!--Median Filter-->
	document.getElementById('median').addEventListener('click', function () {
		filtersize = parseInt(document.getElementById('num').value)
		if (filtersize % 2 == 0 || filtersize < 3) {
			console.warn("FilterSize must Odd Number and >= 3 !")
			return false
		}
		borderparam = (filtersize - 1) / 2
		//copy array to array without reference
		tesbackup = new Array()
		for (var c = 0; c < tes.length; c++) {
			temp = new Array()
			for (var d = 0; d < 4; d++) {
				temp.push(tes[c][d])
			}
			tesbackup.push(temp)
		}
		//end of copy
		for (var i = 0; i < tes.length; i++) {
			xstart = obj.i2x(i) - borderparam
			xend = obj.i2x(i) + borderparam
			ystart = obj.i2y(i) - borderparam
			yend = obj.i2y(i) + borderparam
			red = new Array()
			green = new Array()
			blue = new Array()
			count = 0
			for (var yc = ystart; yc <= yend; yc++) {
				for (var xc = xstart; xc <= xend; xc++) {
					if (yc >= 0 && xc >= 0 && xc < obj.width && yc < obj.height) {
						red.push(tesbackup[obj.xy2i(xc, yc)][0])
						green.push(tesbackup[obj.xy2i(xc, yc)][1])
						blue.push(tesbackup[obj.xy2i(xc, yc)][2])
					}
					count++
				}
			}
			red = arraysort(red)
			green = arraysort(green)
			blue = arraysort(blue)
			if (count % 2 == 0) {
				param = count / 2
			}
			else {
				param = (count - 1) / 2
			}
			tes[i][0] = red[param]
			tes[i][1] = green[param]
			tes[i][2] = blue[param]
		}
		obj.array2canvas(tes)
	})

	
	//Semantic Function Callback
	function callDropdown() {
		$('.ui.dropdown')
			.dropdown();
	}
	setTimeout(callDropdown, 10);	

</script>